Sub InsertImageFromClipboardAsCommentBackground()
    Dim commentPic As Comment
    Dim tempFilePath As String
    
    ' Attempt to get the image from the clipboard
    On Error Resume Next
    SaveClipboardImageToFile tempFilePath
    On Error GoTo 0
    
    If tempFilePath <> "" Then ' Check if an image was successfully saved
        ' Check if a comment exists for the selected cell
        If Not ActiveCell.Comment Is Nothing Then
            Set commentPic = ActiveCell.Comment
        Else
            Set commentPic = ActiveCell.AddComment
        End If
        
        ' Set the comment background as the image from the temporary file
        With commentPic.Shape
            .Fill.UserPicture (tempFilePath)
        End With
        
        ' Clean up the temporary file
        Kill tempFilePath
    Else
        MsgBox "No image found in the clipboard.", vbExclamation
    End If
End Sub

Sub SaveClipboardImageToFile(ByRef filePath As String)
    Dim objImage As Object
    Dim objFileSystem As Object
    
    On Error Resume Next
    ' Attempt to retrieve image from clipboard as bitmap
    Set objImage = GetObject("clipboard:", "Bitmap")
    On Error GoTo 0
    
    If Not objImage Is Nothing Then
        ' Save the image to file
        filePath = Environ("TEMP") & "\clipboard_image.png"
        Set objFileSystem = CreateObject("Scripting.FileSystemObject")
        objImage.SaveAs filePath
    End If
End Sub
